/*! mouldings-test-01 02-01-2017 */
function InitBuffers(){cubeVertexPositionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer),vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW),cubeVertexPositionBuffer.itemSize=3,cubeVertexPositionBuffer.numItems=24,cubeVertexPositionBuffer2=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer2),vertices=[-.5,-.05,.1,.5,-.05,.1,.5,.05,.1,-.5,.05,.1,-.5,-.05,0,-.5,.05,0,.5,.05,0,.5,-.05,0,-.5,.05,0,-.5,.05,.1,.5,.05,.1,.5,.05,0,-.5,-.05,0,.5,-.05,0,.5,-.05,.1,-.5,-.05,.1,.5,-.05,0,.5,.05,0,.5,.05,.1,.5,-.05,.1,-.5,-.05,0,-.5,-.05,.1,-.5,.05,.1,-.5,.05,0],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW),cubeVertexPositionBuffer2.itemSize=3,cubeVertexPositionBuffer2.numItems=24,cubeVertexPositionBuffer3=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer3),vertices=[-.5,-.5,.01,.5,-.5,.01,.5,.5,.01,-.5,.5,.01,-.5,-.5,0,-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,.5,0,-.5,.5,.01,.5,.5,.01,.5,.5,0,-.5,-.5,0,.5,-.5,0,.5,-.5,.01,-.5,-.5,.01,.5,-.5,0,.5,.5,0,.5,.5,.01,.5,-.5,.01,-.5,-.5,0,-.5,-.5,.01,-.5,.5,.01,-.5,.5,0],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW),cubeVertexPositionBuffer3.itemSize=3,cubeVertexPositionBuffer3.numItems=24,cubeVertexIndexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,cubeVertexIndexBuffer);var a=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),gl.STATIC_DRAW),cubeVertexIndexBuffer.itemSize=1,cubeVertexIndexBuffer.numItems=36,cubeVertexNormalBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexNormalBuffer);var b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b),gl.STATIC_DRAW),cubeVertexNormalBuffer.itemSize=3,cubeVertexNormalBuffer.numItems=24,cubeVertexColorBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexColorBuffer),colors=[[1,0,0,1],[1,1,0,1],[0,1,0,1],[1,.5,.5,1],[1,0,1,1],[0,0,1,1]];var c=[];for(var d in colors)for(var e=colors[d],f=0;f<4;f++)c=c.concat(e);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(c),gl.STATIC_DRAW),cubeVertexColorBuffer.itemSize=4,cubeVertexColorBuffer.numItems=24,backgroundPositionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,backgroundPositionBuffer),vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW),backgroundPositionBuffer.itemSize=3,backgroundPositionBuffer.numItems=4,backgroundTextureCoordsBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,backgroundTextureCoordsBuffer);var g=[0,0,1,0,1,1,0,1];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(g),gl.STATIC_DRAW),backgroundTextureCoordsBuffer.itemSize=2,backgroundTextureCoordsBuffer.numItems=4,backgroundIndexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,backgroundIndexBuffer);var h=[0,1,2,0,2,3];gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),gl.STATIC_DRAW),backgroundIndexBuffer.itemSize=1,backgroundIndexBuffer.numItems=6}function InitGL(a){try{gl=a.getContext("experimental-webgl"),gl.viewportWidth=a.width,gl.viewportHeight=a.height}catch(a){}if(!gl)return void alert("Your browser doesn't support WebGL")}function loadShader(a){var b=new XMLHttpRequest;b.open("GET",a),b.onreadystatechange=function(){if(4==b.readyState)return alert(b.responseText),b.responseText},b.send()}function GetShader(a,b){var c=gl.createShader(a);if(gl.shaderSource(c,b),gl.compileShader(c),!gl.getShaderParameter(c,gl.COMPILE_STATUS))throw new Error(gl.getShaderInfoLog(c));return c}function InitShaders(){shaderProgramLight=gl.createProgram(),gl.attachShader(shaderProgramLight,GetShader(gl.VERTEX_SHADER,LightVertexShader)),gl.attachShader(shaderProgramLight,GetShader(gl.FRAGMENT_SHADER,LightFragmentShader)),gl.linkProgram(shaderProgramLight),gl.getProgramParameter(shaderProgramLight,gl.LINK_STATUS)||alert("Could not initialise shaders"),shaderProgramLight.vertexPositionAttribute=gl.getAttribLocation(shaderProgramLight,"aVertexPosition"),gl.enableVertexAttribArray(shaderProgramLight.vertexPositionAttribute),shaderProgramLight.vertexNormalAttribute=gl.getAttribLocation(shaderProgramLight,"aVertexNormal"),gl.enableVertexAttribArray(shaderProgramLight.vertexNormalAttribute),shaderProgramLight.vertexColorUniform=gl.getUniformLocation(shaderProgramLight,"uVertexColor"),shaderProgramLight.pMatrixUniform=gl.getUniformLocation(shaderProgramLight,"uPMatrix"),shaderProgramLight.mvMatrixUniform=gl.getUniformLocation(shaderProgramLight,"uMVMatrix"),shaderProgramLight.nMatrixUniform=gl.getUniformLocation(shaderProgramLight,"uNMatrix"),shaderProgramLight.useLightingUniform=gl.getUniformLocation(shaderProgramLight,"uUseLighting"),shaderProgramLight.ambientColorUniform=gl.getUniformLocation(shaderProgramLight,"uAmbientColor"),shaderProgramLight.lightingDirectionUniform=gl.getUniformLocation(shaderProgramLight,"uLightingDirection"),shaderProgramLight.directionalColorUniform=gl.getUniformLocation(shaderProgramLight,"uDirectionalColor"),shaderProgramTexture=gl.createProgram(),gl.attachShader(shaderProgramTexture,GetShader(gl.VERTEX_SHADER,TextureVertexShader)),gl.attachShader(shaderProgramTexture,GetShader(gl.FRAGMENT_SHADER,TextureFragmentShader)),gl.linkProgram(shaderProgramTexture),shaderProgramTexture.vertexPositionAttribute=gl.getAttribLocation(shaderProgramTexture,"aVertexPosition"),gl.enableVertexAttribArray(shaderProgramTexture.vertexPositionAttribute),shaderProgramTexture.textureCoordAttribute=gl.getAttribLocation(shaderProgramTexture,"aTextureCoord"),gl.enableVertexAttribArray(shaderProgramTexture.textureCoordAttribute),shaderProgramTexture.pMatrixUniform=gl.getUniformLocation(shaderProgramTexture,"uPMatrix"),shaderProgramTexture.mvMatrixUniform=gl.getUniformLocation(shaderProgramTexture,"uMVMatrix"),shaderProgramTexture.samplerUniform=gl.getUniformLocation(shaderProgramTexture,"uSampler")}function handleLoadedTexture2(a){var b=gl.createTexture();gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),gl.bindTexture(gl.TEXTURE_2D,b);var c=document.createElement("canvas");c.width=2048,c.height=2048;var d=c.getContext("2d");if(d.beginPath(),d.rect(0,0,c.width,c.height),d.fillStyle="#000",d.fill(),a.image.width>=a.image.height){var e=c.height*a.image.height/a.image.width;d.drawImage(LoadedImage,0,(c.width-e)/2,c.width,e)}else{var f=c.width*a.image.width/a.image.height;d.drawImage(LoadedImage,(c.height-f)/2,0,f,c.height)}image=c,gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image),gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null),crateTexture=b}function Proportions(a,b){if(GLTexture.image.width>GLTexture.image.height)return 2048*GLTexture.image.height/GLTexture.image.width}function isPowerOfTwo(a){return 0==(a&a-1)}function nextHighestPowerOfTwo(a){--a;for(var b=1;b<32;b<<=1)a|=a>>b;return a+1}function handleLoadedTexture(a){gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),gl.bindTexture(gl.TEXTURE_2D,a),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,a.image),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.bindTexture(gl.TEXTURE_2D,null)}function InitTexture(){crateTexture=gl.createTexture()}function TextureImage(a){crateTexture.image=new Image,crateTexture.image.src=a,crateTexture.image.onload=function(){handleLoadedTexture2(crateTexture)}}function TextureImage3(){crateTexture.image=LoadedImage,crateTexture.image.src=LoadedImage.src,crateTexture.image.width=LoadedImage.width,crateTexture.image.height=LoadedImage.height,crateTexture.image.onload=function(){handleLoadedTexture2(crateTexture)},console.log("Change background")}function mvPushMatrix(){var a=mat4.create();mat4.set(mvMatrix,a),mvMatrixStack.push(a)}function mvPopMatrix(){if(0==mvMatrixStack.length)throw"Invalid popMatrix!";mvMatrix=mvMatrixStack.pop()}function setMatrixUniforms(a){gl.uniformMatrix4fv(a.pMatrixUniform,!1,pMatrix),gl.uniformMatrix4fv(a.mvMatrixUniform,!1,mvMatrix);var b=mat3.create();mat4.toInverseMat3(mvMatrix,b),mat3.transpose(b),gl.uniformMatrix3fv(a.nMatrixUniform,!1,b)}function degToRad(a){return a*Math.PI/180}function handleKeyDown(a){currentlyPressedKeys[a.keyCode]=!0}function handleKeyUp(a){currentlyPressedKeys[a.keyCode]=!1}function HandleKeys(){pitchRate=currentlyPressedKeys[33]?.12:currentlyPressedKeys[34]?-.12:0,yawRate=currentlyPressedKeys[37]||currentlyPressedKeys[65]?.12:currentlyPressedKeys[39]||currentlyPressedKeys[68]?-.12:0,speed=currentlyPressedKeys[38]||currentlyPressedKeys[87]?.003:currentlyPressedKeys[40]||currentlyPressedKeys[83]?-.003:0}function Animate(){var a=(new Date).getTime();if(0!=lastTime){var b=a-lastTime;0!=speed&&(xPos-=Math.sin(degToRad(yaw))*speed*b,zPos-=Math.cos(degToRad(yaw))*speed*b,joggingAngle+=.9*b,yPos=Math.sin(degToRad(joggingAngle))/40+.4),yaw+=yawRate*b,pitch+=pitchRate*b,wallAngle=yaw+90,wallAngle=AngleCalc(wallAngle),ceilingAngle=pitch-90,ceilingAngle=AngleCalc(ceilingAngle)}lastTime=a}function AngleCalc(a){return modulo=a%360,a>=0?modulo>=0&&modulo<180?a=modulo:modulo>=180&&modulo<360&&(a=modulo-360):a<0&&(modulo<=0&&modulo>-180?a=modulo:modulo<=-180&&modulo>-360&&(a=modulo+360)),a}function Tick(){requestAnimFrame(Tick),HandleKeys(),DrawScene()}function MainWebGL(){var a=document.getElementById("webgl-canvas");InitGL(a),InitShaders(),InitBuffers(),InitTexture(),gl.clearColor(0,0,0,1),document.onkeydown=handleKeyDown,document.onkeyup=handleKeyUp,Tick()}function mvPushMatrix(){var a=mat4.create();mat4.set(mvMatrix,a),mvMatrixStack.push(a)}function mvPopMatrix(){if(0==mvMatrixStack.length)throw"Invalid popMatrix!";mvMatrix=mvMatrixStack.pop()}function setMatrixUniforms(a){gl.uniformMatrix4fv(a.pMatrixUniform,!1,pMatrix),gl.uniformMatrix4fv(a.mvMatrixUniform,!1,mvMatrix);var b=mat3.create();mat4.toInverseMat3(mvMatrix,b),mat3.transpose(b),gl.uniformMatrix3fv(a.nMatrixUniform,!1,b)}function degToRad(a){return a*Math.PI/180}function DrawModel(a){1==a?(gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer),gl.vertexAttribPointer(shaderProgramLight.vertexPositionAttribute,cubeVertexPositionBuffer.itemSize,gl.FLOAT,!1,0,0)):2==a?(gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer2),gl.vertexAttribPointer(shaderProgramLight.vertexPositionAttribute,cubeVertexPositionBuffer2.itemSize,gl.FLOAT,!1,0,0)):3==a&&(gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer3),gl.vertexAttribPointer(shaderProgramLight.vertexPositionAttribute,cubeVertexPositionBuffer3.itemSize,gl.FLOAT,!1,0,0)),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexNormalBuffer),gl.vertexAttribPointer(shaderProgramLight.vertexNormalAttribute,cubeVertexNormalBuffer.itemSize,gl.FLOAT,!1,0,0),gl.uniform1i(shaderProgramLight.samplerUniform,0),gl.uniform3f(shaderProgramLight.ambientColorUniform,.2,.2,.2);var b=[-.25,-.25,-1],c=vec3.create();vec3.normalize(b,c),vec3.scale(c,-1),gl.uniform3fv(shaderProgramLight.lightingDirectionUniform,c),gl.uniform3f(shaderProgramLight.directionalColorUniform,.8,.8,.8),gl.uniform4fv(shaderProgramLight.vertexColorUniform,ModelColor),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,cubeVertexIndexBuffer),setMatrixUniforms(shaderProgramLight),gl.drawElements(gl.TRIANGLES,cubeVertexIndexBuffer.numItems,gl.UNSIGNED_SHORT,0)}function DrawBackground(){gl.bindBuffer(gl.ARRAY_BUFFER,backgroundPositionBuffer),gl.vertexAttribPointer(shaderProgramTexture.vertexPositionAttribute,backgroundPositionBuffer.itemSize,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,backgroundTextureCoordsBuffer),gl.vertexAttribPointer(shaderProgramTexture.textureCoordAttribute,backgroundTextureCoordsBuffer.itemSize,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,crateTexture),gl.uniform1i(shaderProgramTexture.samplerUniform,0),setMatrixUniforms(shaderProgramTexture),gl.drawElements(gl.TRIANGLES,backgroundIndexBuffer.numItems,gl.UNSIGNED_SHORT,0)}function DrawScene(){gl.viewport(0,0,gl.viewportWidth,gl.viewportHeight),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),mat4.perspective(45,gl.viewportWidth/gl.viewportHeight,.1,100,pMatrix),mat4.identity(mvMatrix),gl.disable(gl.DEPTH_TEST),gl.useProgram(shaderProgramTexture),mvPushMatrix(),mat4.translate(mvMatrix,[0,0,-3]),DrawBackground(),mvPopMatrix(),gl.enable(gl.DEPTH_TEST),gl.useProgram(shaderProgramLight),mat4.rotate(mvMatrix,degToRad(-pitch),[1,0,0]),mat4.rotate(mvMatrix,degToRad(-yaw),[0,1,0]),mat4.translate(mvMatrix,[-xPos,-yPos,-zPos]),mat4.translate(mvMatrix,[-2,.5,-3]),mvPushMatrix(),mat4.translate(mvMatrix,[3,.45,0]),DrawModel(2),mat4.rotate(mvMatrix,degToRad(90),[0,1,0]),mat4.translate(mvMatrix,[-.5,0,.4]),DrawModel(2),mvPopMatrix()}var cubeVertexPositionBuffer,cubeVertexPositionBuffer2,cubeVertexPositionBuffer3,cubeVertexNormalBuffer,cubeVertexIndexBuffer,cubeVertexColorBuffer,backgroundPositionBuffer,backgroundTextureCoordsBuffer;glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;var vec3={};vec3.create=function(a){var b=new glMatrixArrayType(3);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]),b},vec3.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},vec3.add=function(a,b,c){return c&&a!=c?(c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2],c):(a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a)},vec3.subtract=function(a,b,c){return c&&a!=c?(c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2],c):(a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a)},vec3.negate=function(a,b){return b||(b=a),b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b},vec3.scale=function(a,b,c){return c&&a!=c?(c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c):(a[0]*=b,a[1]*=b,a[2]*=b,a)},vec3.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);return f?1==f?(b[0]=c,b[1]=d,b[2]=e,b):(f=1/f,b[0]=c*f,b[1]=d*f,b[2]=e*f,b):(b[0]=0,b[1]=0,b[2]=0,b)},vec3.cross=function(a,b,c){c||(c=a);var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1];return b=b[2],c[0]=e*b-a*g,c[1]=a*f-d*b,c[2]=d*g-e*f,c},vec3.length=function(a){var b=a[0],c=a[1];return a=a[2],Math.sqrt(b*b+c*c+a*a)},vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},vec3.direction=function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1];return a=a[2]-b[2],(b=Math.sqrt(d*d+e*e+a*a))?(b=1/b,c[0]=d*b,c[1]=e*b,c[2]=a*b,c):(c[0]=0,c[1]=0,c[2]=0,c)},vec3.lerp=function(a,b,c,d){return d||(d=a),d[0]=a[0]+c*(b[0]-a[0]),d[1]=a[1]+c*(b[1]-a[1]),d[2]=a[2]+c*(b[2]-a[2]),d},vec3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var mat3={};mat3.create=function(a){var b=new glMatrixArrayType(9);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9]),b},mat3.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},mat3.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.transpose=function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[5];return a[1]=a[3],a[2]=a[6],a[3]=c,a[5]=a[7],a[6]=d,a[7]=e,a}return b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8],b},mat3.toMat4=function(a,b){return b||(b=mat4.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=0,b[4]=a[3],b[5]=a[4],b[6]=a[5],b[7]=0,b[8]=a[6],b[9]=a[7],b[10]=a[8],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},mat3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"};var mat4={};mat4.create=function(a){var b=new glMatrixArrayType(16);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]),b},mat4.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},mat4.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.transpose=function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],h=a[11];return a[1]=a[4],a[2]=a[8],a[3]=a[12],a[4]=c,a[6]=a[9],a[7]=a[13],a[8]=d,a[9]=f,a[11]=a[14],a[12]=e,a[13]=g,a[14]=h,a}return b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15],b},mat4.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14];return a=a[15],n*k*h*e-j*o*h*e-n*g*l*e+f*o*l*e+j*g*p*e-f*k*p*e-n*k*d*i+j*o*d*i+n*c*l*i-b*o*l*i-j*c*p*i+b*k*p*i+n*g*d*m-f*o*d*m-n*c*h*m+b*o*h*m+f*c*p*m-b*g*p*m-j*g*d*a+f*k*d*a+j*c*h*a-b*k*h*a-f*c*l*a+b*g*l*a},mat4.inverse=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=1/(s*D-t*C+u*B+v*A-w*z+x*y);return b[0]=(h*D-i*C+j*B)*E,b[1]=(-d*D+e*C-f*B)*E,b[2]=(p*x-q*w+r*v)*E,b[3]=(-l*x+m*w-n*v)*E,b[4]=(-g*D+i*A-j*z)*E,b[5]=(c*D-e*A+f*z)*E,b[6]=(-o*x+q*u-r*t)*E,b[7]=(k*x-m*u+n*t)*E,b[8]=(g*C-h*A+j*y)*E,b[9]=(-c*C+d*A-f*y)*E,b[10]=(o*w-p*u+r*s)*E,b[11]=(-k*w+l*u-n*s)*E,b[12]=(-g*B+h*z-i*y)*E,b[13]=(c*B-d*z+e*y)*E,b[14]=(-o*v+p*t-q*s)*E,b[15]=(k*v-l*t+m*s)*E,b},mat4.toRotationMat=function(a,b){return b||(b=mat4.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},mat4.toMat3=function(a,b){return b||(b=mat3.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[4],b[4]=a[5],b[5]=a[6],b[6]=a[8],b[7]=a[9],b[8]=a[10],b},mat4.toInverseMat3=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=a[8],j=a[9],k=a[10],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,b||(b=mat3.create()),b[0]=l*o,b[1]=(-k*d+e*j)*o,b[2]=(h*d-e*g)*o,b[3]=m*o,b[4]=(k*c-e*i)*o,b[5]=(-h*c+e*f)*o,b[6]=n*o,b[7]=(-j*c+d*i)*o,b[8]=(g*c-d*f)*o,b):null},mat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14];a=a[15];var s=b[0],t=b[1],u=b[2],v=b[3],w=b[4],x=b[5],y=b[6],z=b[7],A=b[8],B=b[9],C=b[10],D=b[11],E=b[12],F=b[13],G=b[14];return b=b[15],c[0]=s*d+t*h+u*l+v*p,c[1]=s*e+t*i+u*m+v*q,c[2]=s*f+t*j+u*n+v*r,c[3]=s*g+t*k+u*o+v*a,c[4]=w*d+x*h+y*l+z*p,c[5]=w*e+x*i+y*m+z*q,c[6]=w*f+x*j+y*n+z*r,c[7]=w*g+x*k+y*o+z*a,c[8]=A*d+B*h+C*l+D*p,c[9]=A*e+B*i+C*m+D*q,c[10]=A*f+B*j+C*n+D*r,c[11]=A*g+B*k+C*o+D*a,c[12]=E*d+F*h+G*l+b*p,c[13]=E*e+F*i+G*m+b*q,c[14]=E*f+F*j+G*n+b*r,c[15]=E*g+F*k+G*o+b*a,c},mat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1];return b=b[2],c[0]=a[0]*d+a[4]*e+a[8]*b+a[12],c[1]=a[1]*d+a[5]*e+a[9]*b+a[13],c[2]=a[2]*d+a[6]*e+a[10]*b+a[14],c},mat4.multiplyVec4=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2];return b=b[3],c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*b,c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*b,c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*b,c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*b,c},mat4.translate=function(a,b,c){var d=b[0],e=b[1];if(b=b[2],!c||a==c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;var f=a[0],g=a[1],h=a[2],i=a[3],j=a[4],k=a[5],l=a[6],m=a[7],n=a[8],o=a[9],p=a[10],q=a[11];return c[0]=f,c[1]=g,c[2]=h,c[3]=i,c[4]=j,c[5]=k,c[6]=l,c[7]=m,c[8]=n,c[9]=o,c[10]=p,c[11]=q,c[12]=f*d+j*e+n*b+a[12],c[13]=g*d+k*e+o*b+a[13],c[14]=h*d+l*e+p*b+a[14],c[15]=i*d+m*e+q*b+a[15],c},mat4.scale=function(a,b,c){var d=b[0],e=b[1];return b=b[2],c&&a!=c?(c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d,c[4]=a[4]*e,c[5]=a[5]*e,c[6]=a[6]*e,c[7]=a[7]*e,c[8]=a[8]*b,c[9]=a[9]*b,c[10]=a[10]*b,c[11]=a[11]*b,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c):(a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a)},mat4.rotate=function(a,b,c,d){var e=c[0],f=c[1];c=c[2];var g=Math.sqrt(e*e+f*f+c*c);if(!g)return null;1!=g&&(g=1/g,e*=g,f*=g,c*=g);var h=Math.sin(b),i=Math.cos(b),j=1-i;b=a[0],g=a[1];var k=a[2],l=a[3],m=a[4],n=a[5],o=a[6],p=a[7],q=a[8],r=a[9],s=a[10],t=a[11],u=e*e*j+i,v=f*e*j+c*h,w=c*e*j-f*h,x=e*f*j-c*h,y=f*f*j+i,z=c*f*j+e*h,A=e*c*j+f*h;return e=f*c*j-e*h,f=c*c*j+i,d?a!=d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a,d[0]=b*u+m*v+q*w,d[1]=g*u+n*v+r*w,d[2]=k*u+o*v+s*w,d[3]=l*u+p*v+t*w,d[4]=b*x+m*y+q*z,d[5]=g*x+n*y+r*z,d[6]=k*x+o*y+s*z,d[7]=l*x+p*y+t*z,d[8]=b*A+m*e+q*f,d[9]=g*A+n*e+r*f,d[10]=k*A+o*e+s*f,d[11]=l*A+p*e+t*f,d},mat4.rotateX=function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[4],f=a[5],g=a[6],h=a[7],i=a[8],j=a[9],k=a[10],l=a[11];return c?a!=c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[4]=e*b+i*d,c[5]=f*b+j*d,c[6]=g*b+k*d,c[7]=h*b+l*d,c[8]=e*-d+i*b,c[9]=f*-d+j*b,c[10]=g*-d+k*b,c[11]=h*-d+l*b,c},mat4.rotateY=function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[0],f=a[1],g=a[2],h=a[3],i=a[8],j=a[9],k=a[10],l=a[11];return c?a!=c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[0]=e*b+i*-d,c[1]=f*b+j*-d,c[2]=g*b+k*-d,c[3]=h*b+l*-d,c[8]=e*d+i*b,c[9]=f*d+j*b,c[10]=g*d+k*b,c[11]=h*d+l*b,c},mat4.rotateZ=function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[0],f=a[1],g=a[2],h=a[3],i=a[4],j=a[5],k=a[6],l=a[7];return c?a!=c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[0]=e*b+i*d,c[1]=f*b+j*d,c[2]=g*b+k*d,c[3]=h*b+l*d,c[4]=e*-d+i*b,c[5]=f*-d+j*b,c[6]=g*-d+k*b,c[7]=h*-d+l*b,c},mat4.frustum=function(a,b,c,d,e,f,g){g||(g=mat4.create());var h=b-a,i=d-c,j=f-e;return g[0]=2*e/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=2*e/i,g[6]=0,g[7]=0,g[8]=(b+a)/h,g[9]=(d+c)/i,g[10]=-(f+e)/j,g[11]=-1,g[12]=0,g[13]=0,g[14]=-(f*e*2)/j,g[15]=0,g},mat4.perspective=function(a,b,c,d,e){return a=c*Math.tan(a*Math.PI/360),b*=a,mat4.frustum(-b,b,-a,a,c,d,e)},mat4.ortho=function(a,b,c,d,e,f,g){g||(g=mat4.create());var h=b-a,i=d-c,j=f-e;return g[0]=2/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=2/i,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=-2/j,g[11]=0,g[12]=-(a+b)/h,g[13]=-(d+c)/i,g[14]=-(f+e)/j,g[15]=1,g},mat4.lookAt=function(a,b,c,d){d||(d=mat4.create());var e=a[0],f=a[1];a=a[2];var g=c[0],h=c[1],i=c[2];c=b[1];var j=b[2];if(e==b[0]&&f==c&&a==j)return mat4.identity(d);var k,l,m,n;return c=e-b[0],j=f-b[1],b=a-b[2],n=1/Math.sqrt(c*c+j*j+b*b),c*=n,j*=n,b*=n,k=h*b-i*j,i=i*c-g*b,g=g*j-h*c,(n=Math.sqrt(k*k+i*i+g*g))?(n=1/n,k*=n,i*=n,g*=n):g=i=k=0,h=j*g-b*i,l=b*k-c*g,m=c*i-j*k,(n=Math.sqrt(h*h+l*l+m*m))?(n=1/n,h*=n,l*=n,m*=n):m=l=h=0,d[0]=k,d[1]=h,d[2]=c,d[3]=0,d[4]=i,d[5]=l,d[6]=j,d[7]=0,d[8]=g,d[9]=m,d[10]=b,d[11]=0,d[12]=-(k*e+i*f+g*a),d[13]=-(h*e+l*f+m*a),d[14]=-(c*e+j*f+b*a),d[15]=1,d},mat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"},quat4={},quat4.create=function(a){var b=new glMatrixArrayType(4);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]),b},quat4.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},quat4.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];return b&&a!=b?(b[0]=c,b[1]=d,b[2]=e,b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),b):(a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a)},quat4.inverse=function(a,b){return b&&a!=b?(b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=a[3],b):(a[0]*=1,a[1]*=1,a[2]*=1,a)},quat4.length=function(a){var b=a[0],c=a[1],d=a[2];return a=a[3],Math.sqrt(b*b+c*c+d*d+a*a)},quat4.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=Math.sqrt(c*c+d*d+e*e+f*f);return 0==g?(b[0]=0,b[1]=0,b[2]=0,b[3]=0,b):(g=1/g,b[0]=c*g,b[1]=d*g,b[2]=e*g,b[3]=f*g,b)},quat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2];a=a[3];var g=b[0],h=b[1],i=b[2];return b=b[3],c[0]=d*b+a*g+e*i-f*h,c[1]=e*b+a*h+f*g-d*i,c[2]=f*b+a*i+d*h-e*g,c[3]=a*b-d*g-e*h-f*i,c},quat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2];b=a[0];var g=a[1],h=a[2];a=a[3];var i=a*d+g*f-h*e,j=a*e+h*d-b*f,k=a*f+b*e-g*d;return d=-b*d-g*e-h*f,c[0]=i*a+d*-b+j*-h-k*-g,c[1]=j*a+d*-g+k*-b-i*-h,c[2]=k*a+d*-h+i*-g-j*-b,c},quat4.toMat3=function(a,b){b||(b=mat3.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h;c*=i;var l=d*h;return d*=i,e*=i,g*=f,h*=f,f*=i,b[0]=1-(l+e),b[1]=k-f,b[2]=c+h,b[3]=k+f,b[4]=1-(j+e),b[5]=d-g,b[6]=c-h,b[7]=d+g,b[8]=1-(j+l),b},quat4.toMat4=function(a,b){b||(b=mat4.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h;c*=i;var l=d*h;return d*=i,e*=i,g*=f,h*=f,f*=i,b[0]=1-(l+e),b[1]=k-f,b[2]=c+h,b[3]=0,b[4]=k+f,b[5]=1-(j+e),b[6]=d-g,b[7]=0,b[8]=c-h,b[9]=d+g,b[10]=1-(j+l),b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},quat4.slerp=function(a,b,c,d){d||(d=a);var e=c;return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]<0&&(e=-1*c),d[0]=1-c*a[0]+e*b[0],d[1]=1-c*a[1]+e*b[1],d[2]=1-c*a[2]+e*b[2],d[3]=1-c*a[3]+e*b[3],d},quat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var gl,LightFragmentShader="precision mediump float;varying vec3 vLightWeighting;varying vec4 vColor;void main(void){gl_FragColor = vec4(vLightWeighting, 1.0) * vColor;}",LightVertexShader="attribute vec3 aVertexPosition;attribute vec3 aVertexNormal;uniform vec4 uVertexColor;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;uniform mat3 uNMatrix;uniform vec3 uAmbientColor;uniform vec3 uLightingDirection;uniform vec3 uDirectionalColor;varying vec3 vLightWeighting;varying vec4 vColor;void main(void){gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);vec3 transformedNormal = uNMatrix * aVertexNormal;float directionalLightWeighting = max(dot(transformedNormal, uLightingDirection), 0.0);vLightWeighting = uAmbientColor + uDirectionalColor * directionalLightWeighting;vColor = uVertexColor;}",TextureFragmentShader="precision mediump float;varying vec2 vTextureCoord;uniform sampler2D uSampler;void main(void){gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));}",TextureVertexShader="attribute vec3 aVertexPosition;attribute vec2 aTextureCoord;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying vec2 vTextureCoord;void main(void){gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);vTextureCoord = aTextureCoord;}",shaderProgramLight,shaderProgramTexture,crateTexture,LoadedImage,mvMatrix=mat4.create(),mvMatrixStack=[],pMatrix=mat4.create(),currentlyPressedKeys={},pitch=0,pitchRate=0,yaw=0,yawRate=0,xPos=0,yPos=.4,zPos=0,speed=0,ModelColor=[1,1,1,1],lastTime=0,joggingAngle=0,WebGL={};WebGL.InitApp=function(a){var b=document.createElement("canvas");b.setAttribute("id","webgl-canvas"),b.setAttribute("width",a.offsetWidth),b.setAttribute("height",a.offsetHeight),a.appendChild(b),MainWebGL()},WebGL.PosX=function(a){xPos=a},WebGL.PosZ=function(a){zPos=-a},WebGL.RotateX=function(a){yaw=a-90},WebGL.RotateY=function(a){pitch=a+90},WebGL.ModelColor=function(a){function b(a){return a/255}ModelColor=a,ModelColor=[b(a[0]),b(a[1]),b(a[2]),b(a[3])]},WebGL.Background=function(a){LoadedImage=a,TextureImage3()};var worldVertexPositionBuffer=null,worldVertexTextureCoordBuffer=null,mvMatrix=mat4.create(),mvMatrixStack=[],pMatrix=mat4.create();WebGLUtils=function(){var a=function(a){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+a+"</div></div></td></tr></table>"},b='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',c='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>',d=function(d,f,g){function h(e){var f=d.parentNode;if(f){var g=window.WebGLRenderingContext?c:b;e&&(g+="<br/><br/>Status: "+e),f.innerHTML=a(g)}}g=g||h,d.addEventListener&&d.addEventListener("webglcontextcreationerror",function(a){g(a.statusMessage)},!1);var i=e(d,f);return i||window.WebGLRenderingContext||g(""),i},e=function(a,b){for(var c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=null,e=0;e<c.length;++e){try{d=a.getContext(c[e],b)}catch(a){}if(d)break}return d};return{create3DContext:e,setupWebGL:d}}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}();