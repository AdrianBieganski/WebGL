/*! mouldings-test-01 08-01-2017 */
function InitBuffers(){cubeVertexPositionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer),vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW),cubeVertexPositionBuffer.itemSize=3,cubeVertexPositionBuffer.numItems=24,cubeVertexPositionBuffer2=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer2),vertices=[-.5,-.05,.1,.5,-.05,.1,.5,.05,.1,-.5,.05,.1,-.5,-.05,0,-.5,.05,0,.5,.05,0,.5,-.05,0,-.5,.05,0,-.5,.05,.1,.5,.05,.1,.5,.05,0,-.5,-.05,0,.5,-.05,0,.5,-.05,.1,-.5,-.05,.1,.5,-.05,0,.5,.05,0,.5,.05,.1,.5,-.05,.1,-.5,-.05,0,-.5,-.05,.1,-.5,.05,.1,-.5,.05,0],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW),cubeVertexPositionBuffer2.itemSize=3,cubeVertexPositionBuffer2.numItems=24,cubeVertexPositionBuffer3=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer3),vertices=[-.5,-.5,.01,.5,-.5,.01,.5,.5,.01,-.5,.5,.01,-.5,-.5,0,-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,.5,0,-.5,.5,.01,.5,.5,.01,.5,.5,0,-.5,-.5,0,.5,-.5,0,.5,-.5,.01,-.5,-.5,.01,.5,-.5,0,.5,.5,0,.5,.5,.01,.5,-.5,.01,-.5,-.5,0,-.5,-.5,.01,-.5,.5,.01,-.5,.5,0],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW),cubeVertexPositionBuffer3.itemSize=3,cubeVertexPositionBuffer3.numItems=24,cubeVertexIndexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,cubeVertexIndexBuffer);var a=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),gl.STATIC_DRAW),cubeVertexIndexBuffer.itemSize=1,cubeVertexIndexBuffer.numItems=36,cubeVertexNormalBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexNormalBuffer);var b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b),gl.STATIC_DRAW),cubeVertexNormalBuffer.itemSize=3,cubeVertexNormalBuffer.numItems=24,cubeVertexColorBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexColorBuffer),colors=[[1,0,0,1],[1,1,0,1],[0,1,0,1],[1,.5,.5,1],[1,0,1,1],[0,0,1,1]];var c=[];for(var d in colors)for(var e=colors[d],f=0;f<4;f++)c=c.concat(e);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(c),gl.STATIC_DRAW),cubeVertexColorBuffer.itemSize=4,cubeVertexColorBuffer.numItems=24,backgroundPositionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,backgroundPositionBuffer),vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW),backgroundPositionBuffer.itemSize=3,backgroundPositionBuffer.numItems=4,backgroundTextureCoordsBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,backgroundTextureCoordsBuffer);var g=[0,0,1,0,1,1,0,1];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(g),gl.STATIC_DRAW),backgroundTextureCoordsBuffer.itemSize=2,backgroundTextureCoordsBuffer.numItems=4,backgroundIndexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,backgroundIndexBuffer);var h=[0,1,2,0,2,3];gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),gl.STATIC_DRAW),backgroundIndexBuffer.itemSize=1,backgroundIndexBuffer.numItems=6}function InitGL(a){try{gl=a.getContext("experimental-webgl"),gl.viewportWidth=a.width,gl.viewportHeight=a.height}catch(a){}if(!gl)return void alert("Your browser doesn't support WebGL")}function loadShader(a){var b=new XMLHttpRequest;b.open("GET",a),b.onreadystatechange=function(){if(4==b.readyState)return alert(b.responseText),b.responseText},b.send()}function GetShader(a,b){var c=gl.createShader(a);if(gl.shaderSource(c,b),gl.compileShader(c),!gl.getShaderParameter(c,gl.COMPILE_STATUS))throw new Error(gl.getShaderInfoLog(c));return c}function InitShaders(){shaderProgramLight=gl.createProgram(),gl.attachShader(shaderProgramLight,GetShader(gl.VERTEX_SHADER,LightVertexShader)),gl.attachShader(shaderProgramLight,GetShader(gl.FRAGMENT_SHADER,LightFragmentShader)),gl.linkProgram(shaderProgramLight),gl.getProgramParameter(shaderProgramLight,gl.LINK_STATUS)||alert("Could not initialise shaders"),shaderProgramLight.vertexPositionAttribute=gl.getAttribLocation(shaderProgramLight,"aVertexPosition"),gl.enableVertexAttribArray(shaderProgramLight.vertexPositionAttribute),shaderProgramLight.vertexNormalAttribute=gl.getAttribLocation(shaderProgramLight,"aVertexNormal"),gl.enableVertexAttribArray(shaderProgramLight.vertexNormalAttribute),shaderProgramLight.vertexColorUniform=gl.getUniformLocation(shaderProgramLight,"uVertexColor"),shaderProgramLight.pMatrixUniform=gl.getUniformLocation(shaderProgramLight,"uPMatrix"),shaderProgramLight.mvMatrixUniform=gl.getUniformLocation(shaderProgramLight,"uMVMatrix"),shaderProgramLight.nMatrixUniform=gl.getUniformLocation(shaderProgramLight,"uNMatrix"),shaderProgramLight.useLightingUniform=gl.getUniformLocation(shaderProgramLight,"uUseLighting"),shaderProgramLight.ambientColorUniform=gl.getUniformLocation(shaderProgramLight,"uAmbientColor"),shaderProgramLight.lightingDirectionUniform=gl.getUniformLocation(shaderProgramLight,"uLightingDirection"),shaderProgramLight.directionalColorUniform=gl.getUniformLocation(shaderProgramLight,"uDirectionalColor"),shaderProgramTexture=gl.createProgram(),gl.attachShader(shaderProgramTexture,GetShader(gl.VERTEX_SHADER,TextureVertexShader)),gl.attachShader(shaderProgramTexture,GetShader(gl.FRAGMENT_SHADER,TextureFragmentShader)),gl.linkProgram(shaderProgramTexture),shaderProgramTexture.vertexPositionAttribute=gl.getAttribLocation(shaderProgramTexture,"aVertexPosition"),gl.enableVertexAttribArray(shaderProgramTexture.vertexPositionAttribute),shaderProgramTexture.textureCoordAttribute=gl.getAttribLocation(shaderProgramTexture,"aTextureCoord"),gl.enableVertexAttribArray(shaderProgramTexture.textureCoordAttribute),shaderProgramTexture.pMatrixUniform=gl.getUniformLocation(shaderProgramTexture,"uPMatrix"),shaderProgramTexture.mvMatrixUniform=gl.getUniformLocation(shaderProgramTexture,"uMVMatrix"),shaderProgramTexture.samplerUniform=gl.getUniformLocation(shaderProgramTexture,"uSampler")}function cameraSet(a){for(var b=0;b<16;b++)mtrxProjection[b]=0,mtrxView[b]=0,mtrxProjectionAndView[b]=0;var c=a[2]/a[0];Matrix.perspectiveM(mtrxProjection,0,40,mScreenWidth/mScreenHeight,.01,50);var d=-.25,e=d/c,f=d;Matrix.setLookAtM(mtrxView,0,e,0,f,0,0,0,0,a[1],Math.sqrt(a[0]*a[0]+a[2]*a[2])),Matrix.multiplyMM(mtrxProjectionAndView,0,mtrxProjection,0,mtrxView,0)}function projectAngle(a,b){var c,d=(a+Math.PI)%(2*Math.PI)-Math.PI,e=Math.PI;return c=-1*Math.acos(-1*Math.pow(1+Math.pow(b,2),.5)*Math.sin(d)*Math.pow(Math.pow(b,2)*Math.pow(Math.cos(d),2)+Math.pow(Math.sin(d),2)+Math.pow(b,2)*Math.pow(Math.sin(d),2),-.5))*(-.5*e+Math.abs(d)>0?1:-1)}function wallsSet(a,b,c,d){var e=c-Math.PI/2,f=d[2]/d[0],g=projectAngle(a-e,f),h=projectAngle(b-e,f);dir1[0]=Math.cos(g),dir1[1]=Math.sin(g),dir1[2]=0,dir2[0]=Math.cos(h),dir2[1]=Math.sin(h),dir2[2]=0}function InitTexture(){BackgroundTexture=gl.createTexture()}function SetTextureImage(a,b){var c=document.createElement("canvas");c.width=2048,c.height=2048;var d=c.getContext("2d");if(d.beginPath(),d.rect(0,0,c.width,c.height),d.fillStyle="#000",d.fill(),b.width>=b.height){var e=c.height*b.height/b.width;d.drawImage(b,0,(c.width-e)/2,c.width,e)}else{var f=c.width*b.width/b.height;d.drawImage(b,(c.height-f)/2,0,f,c.height)}if(void 0==ImagesArray[a]){var g=gl.createTexture();gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),gl.bindTexture(gl.TEXTURE_2D,g),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,c),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.bindTexture(gl.TEXTURE_2D,null),ImagesArray[a]=g,console.log("New id has created.")}else gl.bindTexture(gl.TEXTURE_2D,ImagesArray[a]),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,c),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.bindTexture(gl.TEXTURE_2D,null),console.log("Id has changed.")}function ShowTextureImage(a){void 0!=ImagesArray[a]?(BackgroundTexture=ImagesArray[a],console.log("Background changed.")):console.log("Image does not init.")}function handleKeyDown(a){currentlyPressedKeys[a.keyCode]=!0}function handleKeyUp(a){currentlyPressedKeys[a.keyCode]=!1}function HandleKeys(){pitchRate=currentlyPressedKeys[33]?.12:currentlyPressedKeys[34]?-.12:0,yawRate=currentlyPressedKeys[37]||currentlyPressedKeys[65]?.12:currentlyPressedKeys[39]||currentlyPressedKeys[68]?-.12:0,speed=currentlyPressedKeys[38]||currentlyPressedKeys[87]?.003:currentlyPressedKeys[40]||currentlyPressedKeys[83]?-.003:0}function Animate(){var a=(new Date).getTime();if(0!=lastTime){var b=a-lastTime;0!=speed&&(xPos-=Math.sin(degToRad(yaw))*speed*b,zPos-=Math.cos(degToRad(yaw))*speed*b,joggingAngle+=.9*b,yPos=Math.sin(degToRad(joggingAngle))/40+.4),yaw+=yawRate*b,pitch+=pitchRate*b,wallAngle=yaw+90,wallAngle=AngleCalc(wallAngle),ceilingAngle=pitch-90,ceilingAngle=AngleCalc(ceilingAngle)}lastTime=a}function AngleCalc(a){return modulo=a%360,a>=0?modulo>=0&&modulo<180?a=modulo:modulo>=180&&modulo<360&&(a=modulo-360):a<0&&(modulo<=0&&modulo>-180?a=modulo:modulo<=-180&&modulo>-360&&(a=modulo+360)),a}function Tick(){requestAnimFrame(Tick),HandleKeys(),DrawScene()}function MainWebGL(){var a=document.getElementById("webgl-canvas");InitGL(a),InitShaders(),InitBuffers(),InitTexture(),gl.clearColor(0,0,0,1),document.onkeydown=handleKeyDown,document.onkeyup=handleKeyUp,Tick()}function mvPushMatrix(){var a=new Float32Array(16);Matrix.Copy(mvMatrix,a),mvMatrixStack.push(a)}function mvPopMatrix(){if(0==mvMatrixStack.length)throw"Invalid popMatrix!";mvMatrix=mvMatrixStack.pop()}function setMatrixUniforms(a){gl.uniformMatrix4fv(a.pMatrixUniform,!1,pMatrix),gl.uniformMatrix4fv(a.mvMatrixUniform,!1,mvMatrix);var b=new Float32Array(9);Matrix.InverseToMat3(mvMatrix,b),Matrix.transposeM(b),gl.uniformMatrix3fv(a.nMatrixUniform,!1,b)}function degToRad(a){return a*Math.PI/180}function DrawModel(a){1==a?(gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer),gl.vertexAttribPointer(shaderProgramLight.vertexPositionAttribute,cubeVertexPositionBuffer.itemSize,gl.FLOAT,!1,0,0)):2==a?(gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer2),gl.vertexAttribPointer(shaderProgramLight.vertexPositionAttribute,cubeVertexPositionBuffer2.itemSize,gl.FLOAT,!1,0,0)):3==a&&(gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexPositionBuffer3),gl.vertexAttribPointer(shaderProgramLight.vertexPositionAttribute,cubeVertexPositionBuffer3.itemSize,gl.FLOAT,!1,0,0)),gl.bindBuffer(gl.ARRAY_BUFFER,cubeVertexNormalBuffer),gl.vertexAttribPointer(shaderProgramLight.vertexNormalAttribute,cubeVertexNormalBuffer.itemSize,gl.FLOAT,!1,0,0),gl.uniform1i(shaderProgramLight.samplerUniform,0),gl.uniform3f(shaderProgramLight.ambientColorUniform,.2,.2,.2);var b=[-.25,-.25,-1],c=new Float32Array(3);Vector3.Normalize(b,c),Vector3.Scale(c,-1),gl.uniform3fv(shaderProgramLight.lightingDirectionUniform,c),gl.uniform3f(shaderProgramLight.directionalColorUniform,.8,.8,.8),gl.uniform4fv(shaderProgramLight.vertexColorUniform,ModelColor),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,cubeVertexIndexBuffer),setMatrixUniforms(shaderProgramLight),gl.drawElements(gl.TRIANGLES,cubeVertexIndexBuffer.numItems,gl.UNSIGNED_SHORT,0)}function DrawBackground(){gl.bindBuffer(gl.ARRAY_BUFFER,backgroundPositionBuffer),gl.vertexAttribPointer(shaderProgramTexture.vertexPositionAttribute,backgroundPositionBuffer.itemSize,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,backgroundTextureCoordsBuffer),gl.vertexAttribPointer(shaderProgramTexture.textureCoordAttribute,backgroundTextureCoordsBuffer.itemSize,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,BackgroundTexture),gl.uniform1i(shaderProgramTexture.samplerUniform,0),setMatrixUniforms(shaderProgramTexture),gl.drawElements(gl.TRIANGLES,backgroundIndexBuffer.numItems,gl.UNSIGNED_SHORT,0)}function DrawScene(){gl.viewport(0,0,gl.viewportWidth,gl.viewportHeight),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),Matrix.perspectiveM(pMatrix,0,45,gl.viewportWidth/gl.viewportHeight,.1,100),Matrix.Identity(mvMatrix),gl.disable(gl.DEPTH_TEST),gl.useProgram(shaderProgramTexture),mvPushMatrix(),Matrix.translateM(mvMatrix,0,0,0,-3),DrawBackground(),mvPopMatrix(),gl.enable(gl.DEPTH_TEST),gl.useProgram(shaderProgramLight),Matrix.rotateM(mvMatrix,0,degToRad(-pitch),1,0,0),Matrix.rotateM(mvMatrix,0,degToRad(-yaw),0,1,0),Matrix.translateM(mvMatrix,0,-xPos,-yPos,-zPos),Matrix.translateM(mvMatrix,0,-2,.5,-3),mvPushMatrix(),Matrix.translateM(mvMatrix,0,3,.45,0),DrawModel(2),Matrix.rotateM(mvMatrix,0,degToRad(90),0,1,0),Matrix.translateM(mvMatrix,0,-.5,0,.4),DrawModel(2),mvPopMatrix()}var cubeVertexPositionBuffer,cubeVertexPositionBuffer2,cubeVertexPositionBuffer3,cubeVertexNormalBuffer,cubeVertexIndexBuffer,cubeVertexColorBuffer,backgroundPositionBuffer,backgroundTextureCoordsBuffer;"undefined"!=typeof Float32Array?glMatrixArrayType=Float32Array:"undefined"!=typeof WebGLFloatArray?glMatrixArrayType=WebGLFloatArray:glMatrixArrayType=Array;var vec3={};vec3.create=function(a){var b=new glMatrixArrayType(3);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]),b},vec3.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},vec3.add=function(a,b,c){return c&&a!=c?(c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2],c):(a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a)},vec3.subtract=function(a,b,c){return c&&a!=c?(c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2],c):(a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a)},vec3.negate=function(a,b){return b||(b=a),b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b},vec3.scale=function(a,b,c){return c&&a!=c?(c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c):(a[0]*=b,a[1]*=b,a[2]*=b,a)},vec3.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);return f?1==f?(b[0]=c,b[1]=d,b[2]=e,b):(f=1/f,b[0]=c*f,b[1]=d*f,b[2]=e*f,b):(b[0]=0,b[1]=0,b[2]=0,b)},vec3.cross=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=b[0],h=b[1],i=b[2];return c[0]=e*i-f*h,c[1]=f*g-d*i,c[2]=d*h-e*g,c},vec3.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},vec3.direction=function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1],f=a[2]-b[2],g=Math.sqrt(d*d+e*e+f*f);return g?(g=1/g,c[0]=d*g,c[1]=e*g,c[2]=f*g,c):(c[0]=0,c[1]=0,c[2]=0,c)},vec3.lerp=function(a,b,c,d){return d||(d=a),d[0]=a[0]+c*(b[0]-a[0]),d[1]=a[1]+c*(b[1]-a[1]),d[2]=a[2]+c*(b[2]-a[2]),d},vec3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var mat3={};mat3.create=function(a){var b=new glMatrixArrayType(9);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]),b},mat3.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},mat3.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.transpose=function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[5];return a[1]=a[3],a[2]=a[6],a[3]=c,a[5]=a[7],a[6]=d,a[7]=e,a}return b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8],b},mat3.toMat4=function(a,b){return b||(b=mat4.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=0,b[4]=a[3],b[5]=a[4],b[6]=a[5],b[7]=0,b[8]=a[6],b[9]=a[7],b[10]=a[8],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},mat3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"};var mat4={};mat4.create=function(a){var b=new glMatrixArrayType(16);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]),b},mat4.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},mat4.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.transpose=function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],h=a[11];return a[1]=a[4],a[2]=a[8],a[3]=a[12],a[4]=c,a[6]=a[9],a[7]=a[13],a[8]=d,a[9]=f,a[11]=a[14],a[12]=e,a[13]=g,a[14]=h,a}return b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15],b},mat4.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15];return n*k*h*e-j*o*h*e-n*g*l*e+f*o*l*e+j*g*p*e-f*k*p*e-n*k*d*i+j*o*d*i+n*c*l*i-b*o*l*i-j*c*p*i+b*k*p*i+n*g*d*m-f*o*d*m-n*c*h*m+b*o*h*m+f*c*p*m-b*g*p*m-j*g*d*q+f*k*d*q+j*c*h*q-b*k*h*q-f*c*l*q+b*g*l*q},mat4.inverse=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=1/(s*D-t*C+u*B+v*A-w*z+x*y);return b[0]=(h*D-i*C+j*B)*E,b[1]=(-d*D+e*C-f*B)*E,b[2]=(p*x-q*w+r*v)*E,b[3]=(-l*x+m*w-n*v)*E,b[4]=(-g*D+i*A-j*z)*E,b[5]=(c*D-e*A+f*z)*E,b[6]=(-o*x+q*u-r*t)*E,b[7]=(k*x-m*u+n*t)*E,b[8]=(g*C-h*A+j*y)*E,b[9]=(-c*C+d*A-f*y)*E,b[10]=(o*w-p*u+r*s)*E,b[11]=(-k*w+l*u-n*s)*E,b[12]=(-g*B+h*z-i*y)*E,b[13]=(c*B-d*z+e*y)*E,b[14]=(-o*v+p*t-q*s)*E,b[15]=(k*v-l*t+m*s)*E,b},mat4.toRotationMat=function(a,b){return b||(b=mat4.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},mat4.toMat3=function(a,b){return b||(b=mat3.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[4],b[4]=a[5],b[5]=a[6],b[6]=a[8],b[7]=a[9],b[8]=a[10],b},mat4.toInverseMat3=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=a[8],j=a[9],k=a[10],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;if(!o)return null;var p=1/o;return b||(b=mat3.create()),b[0]=l*p,b[1]=(-k*d+e*j)*p,b[2]=(h*d-e*g)*p,b[3]=m*p,b[4]=(k*c-e*i)*p,b[5]=(-h*c+e*f)*p,b[6]=n*p,b[7]=(-j*c+d*i)*p,b[8]=(g*c-d*f)*p,b},mat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14],s=a[15],t=b[0],u=b[1],v=b[2],w=b[3],x=b[4],y=b[5],z=b[6],A=b[7],B=b[8],C=b[9],D=b[10],E=b[11],F=b[12],G=b[13],H=b[14],I=b[15];return c[0]=t*d+u*h+v*l+w*p,c[1]=t*e+u*i+v*m+w*q,c[2]=t*f+u*j+v*n+w*r,c[3]=t*g+u*k+v*o+w*s,c[4]=x*d+y*h+z*l+A*p,c[5]=x*e+y*i+z*m+A*q,c[6]=x*f+y*j+z*n+A*r,c[7]=x*g+y*k+z*o+A*s,c[8]=B*d+C*h+D*l+E*p,c[9]=B*e+C*i+D*m+E*q,c[10]=B*f+C*j+D*n+E*r,c[11]=B*g+C*k+D*o+E*s,c[12]=F*d+G*h+H*l+I*p,c[13]=F*e+G*i+H*m+I*q,c[14]=F*f+G*j+H*n+I*r,c[15]=F*g+G*k+H*o+I*s,c},mat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2];return c[0]=a[0]*d+a[4]*e+a[8]*f+a[12],c[1]=a[1]*d+a[5]*e+a[9]*f+a[13],c[2]=a[2]*d+a[6]*e+a[10]*f+a[14],c},mat4.multiplyVec4=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],g=b[3];return c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*g,c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*g,c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*g,c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*g,c},mat4.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2];if(!c||a==c)return a[12]=a[0]*d+a[4]*e+a[8]*f+a[12],a[13]=a[1]*d+a[5]*e+a[9]*f+a[13],a[14]=a[2]*d+a[6]*e+a[10]*f+a[14],a[15]=a[3]*d+a[7]*e+a[11]*f+a[15],a;var g=a[0],h=a[1],i=a[2],j=a[3],k=a[4],l=a[5],m=a[6],n=a[7],o=a[8],p=a[9],q=a[10],r=a[11];return c[0]=g,c[1]=h,c[2]=i,c[3]=j,c[4]=k,c[5]=l,c[6]=m,c[7]=n,c[8]=o,c[9]=p,c[10]=q,c[11]=r,c[12]=g*d+k*e+o*f+a[12],c[13]=h*d+l*e+p*f+a[13],c[14]=i*d+m*e+q*f+a[14],c[15]=j*d+n*e+r*f+a[15],c},mat4.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2];return c&&a!=c?(c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d,c[4]=a[4]*e,c[5]=a[5]*e,c[6]=a[6]*e,c[7]=a[7]*e,c[8]=a[8]*f,c[9]=a[9]*f,c[10]=a[10]*f,c[11]=a[11]*f,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c):(a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=f,a[9]*=f,a[10]*=f,a[11]*=f,a)},mat4.rotate=function(a,b,c,d){var e=c[0],f=c[1],g=c[2],h=Math.sqrt(e*e+f*f+g*g);if(!h)return null;1!=h&&(h=1/h,e*=h,f*=h,g*=h);var i=Math.sin(b),j=Math.cos(b),k=1-j,l=a[0],m=a[1],n=a[2],o=a[3],p=a[4],q=a[5],r=a[6],s=a[7],t=a[8],u=a[9],v=a[10],w=a[11],x=e*e*k+j,y=f*e*k+g*i,z=g*e*k-f*i,A=e*f*k-g*i,B=f*f*k+j,C=g*f*k+e*i,D=e*g*k+f*i,E=f*g*k-e*i,F=g*g*k+j;return d?a!=d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a,d[0]=l*x+p*y+t*z,d[1]=m*x+q*y+u*z,d[2]=n*x+r*y+v*z,d[3]=o*x+s*y+w*z,d[4]=l*A+p*B+t*C,d[5]=m*A+q*B+u*C,d[6]=n*A+r*B+v*C,d[7]=o*A+s*B+w*C,d[8]=l*D+p*E+t*F,d[9]=m*D+q*E+u*F,d[10]=n*D+r*E+v*F,d[11]=o*D+s*E+w*F,d},mat4.rotateX=function(a,b,c){var d=Math.sin(b),e=Math.cos(b),f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11];return c?a!=c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[4]=f*e+j*d,c[5]=g*e+k*d,c[6]=h*e+l*d,c[7]=i*e+m*d,c[8]=f*-d+j*e,c[9]=g*-d+k*e,c[10]=h*-d+l*e,c[11]=i*-d+m*e,c},mat4.rotateY=function(a,b,c){var d=Math.sin(b),e=Math.cos(b),f=a[0],g=a[1],h=a[2],i=a[3],j=a[8],k=a[9],l=a[10],m=a[11];return c?a!=c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[0]=f*e+j*-d,c[1]=g*e+k*-d,c[2]=h*e+l*-d,c[3]=i*e+m*-d,c[8]=f*d+j*e,c[9]=g*d+k*e,c[10]=h*d+l*e,c[11]=i*d+m*e,c},mat4.rotateZ=function(a,b,c){var d=Math.sin(b),e=Math.cos(b),f=a[0],g=a[1],h=a[2],i=a[3],j=a[4],k=a[5],l=a[6],m=a[7];return c?a!=c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[0]=f*e+j*d,c[1]=g*e+k*d,c[2]=h*e+l*d,c[3]=i*e+m*d,c[4]=f*-d+j*e,c[5]=g*-d+k*e,c[6]=h*-d+l*e,c[7]=i*-d+m*e,c},mat4.frustum=function(a,b,c,d,e,f,g){g||(g=mat4.create());var h=b-a,i=d-c,j=f-e;return g[0]=2*e/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=2*e/i,g[6]=0,g[7]=0,g[8]=(b+a)/h,g[9]=(d+c)/i,g[10]=-(f+e)/j,g[11]=-1,g[12]=0,g[13]=0,g[14]=-(f*e*2)/j,g[15]=0,g},mat4.perspective=function(a,b,c,d,e){var f=c*Math.tan(a*Math.PI/360),g=f*b;return mat4.frustum(-g,g,-f,f,c,d,e)},mat4.ortho=function(a,b,c,d,e,f,g){g||(g=mat4.create());var h=b-a,i=d-c,j=f-e;return g[0]=2/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=2/i,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=-2/j,g[11]=0,g[12]=-(a+b)/h,g[13]=-(d+c)/i,g[14]=-(f+e)/j,g[15]=1,g},mat4.lookAt=function(a,b,c,d){d||(d=mat4.create());var e=a[0],f=a[1],g=a[2],h=c[0],i=c[1],j=c[2],k=b[0],l=b[1],m=b[2];if(e==k&&f==l&&g==m)return mat4.identity(d);var n,o,p,q,r,s,t,u,v,w;return n=e-b[0],o=f-b[1],p=g-b[2],w=1/Math.sqrt(n*n+o*o+p*p),n*=w,o*=w,p*=w,q=i*p-j*o,r=j*n-h*p,s=h*o-i*n,w=Math.sqrt(q*q+r*r+s*s),w?(w=1/w,q*=w,r*=w,s*=w):(q=0,r=0,s=0),t=o*s-p*r,u=p*q-n*s,v=n*r-o*q,w=Math.sqrt(t*t+u*u+v*v),w?(w=1/w,t*=w,u*=w,v*=w):(t=0,u=0,v=0),d[0]=q,d[1]=t,d[2]=n,d[3]=0,d[4]=r,d[5]=u,d[6]=o,d[7]=0,d[8]=s,d[9]=v,d[10]=p,d[11]=0,d[12]=-(q*e+r*f+s*g),d[13]=-(t*e+u*f+v*g),d[14]=-(n*e+o*f+p*g),d[15]=1,d},mat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"},quat4={},quat4.create=function(a){var b=new glMatrixArrayType(4);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]),b},quat4.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},quat4.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];return b&&a!=b?(b[0]=c,b[1]=d,b[2]=e,b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),b):(a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a)},quat4.inverse=function(a,b){return b&&a!=b?(b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=a[3],b):(a[0]*=-1,a[1]*=-1,a[2]*=-1,a)},quat4.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},quat4.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=Math.sqrt(c*c+d*d+e*e+f*f);return 0==g?(b[0]=0,b[1]=0,b[2]=0,b[3]=0,b):(g=1/g,b[0]=c*g,b[1]=d*g,b[2]=e*g,b[3]=f*g,b)},quat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=b[0],i=b[1],j=b[2],k=b[3];return c[0]=d*k+g*h+e*j-f*i,c[1]=e*k+g*i+f*h-d*j,c[2]=f*k+g*j+d*i-e*h,c[3]=g*k-d*h-e*i-f*j,c},quat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],g=a[0],h=a[1],i=a[2],j=a[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return c[0]=k*j+n*-g+l*-i-m*-h,c[1]=l*j+n*-h+m*-g-k*-i,c[2]=m*j+n*-i+k*-h-l*-g,c},quat4.toMat3=function(a,b){b||(b=mat3.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[1]=k-r,b[2]=l+q,b[3]=k+r,b[4]=1-(j+o),b[5]=n-p,b[6]=l-q,b[7]=n+p,b[8]=1-(j+m),b},quat4.toMat4=function(a,b){b||(b=mat4.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[1]=k-r,b[2]=l+q,b[3]=0,b[4]=k+r,b[5]=1-(j+o),b[6]=n-p,b[7]=0,b[8]=l-q,b[9]=n+p,b[10]=1-(j+m),b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},quat4.slerp=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];if(Math.abs(e)>=1)return d!=a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;var f=Math.acos(e),g=Math.sqrt(1-e*e);if(Math.abs(g)<.001)return d[0]=.5*a[0]+.5*b[0],d[1]=.5*a[1]+.5*b[1],d[2]=.5*a[2]+.5*b[2],d[3]=.5*a[3]+.5*b[3],d;var h=Math.sin((1-c)*f)/g,i=Math.sin(c*f)/g;return d[0]=a[0]*h+b[0]*i,d[1]=a[1]*h+b[1]*i,d[2]=a[2]*h+b[2]*i,d[3]=a[3]*h+b[3]*i,d},quat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"},glMatrixArrayType="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;var vec3={};vec3.create=function(a){var b=new glMatrixArrayType(3);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]),b},vec3.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},vec3.add=function(a,b,c){return c&&a!=c?(c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2],c):(a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a)},vec3.subtract=function(a,b,c){return c&&a!=c?(c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2],c):(a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a)},vec3.negate=function(a,b){return b||(b=a),b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b},vec3.scale=function(a,b,c){return c&&a!=c?(c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c):(a[0]*=b,a[1]*=b,a[2]*=b,a)},vec3.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);return f?1==f?(b[0]=c,b[1]=d,b[2]=e,b):(f=1/f,b[0]=c*f,b[1]=d*f,b[2]=e*f,b):(b[0]=0,b[1]=0,b[2]=0,b)},vec3.cross=function(a,b,c){c||(c=a);var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1];return b=b[2],c[0]=e*b-a*g,c[1]=a*f-d*b,c[2]=d*g-e*f,c},vec3.length=function(a){var b=a[0],c=a[1];return a=a[2],Math.sqrt(b*b+c*c+a*a)},vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},vec3.direction=function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1];return a=a[2]-b[2],(b=Math.sqrt(d*d+e*e+a*a))?(b=1/b,c[0]=d*b,c[1]=e*b,c[2]=a*b,c):(c[0]=0,c[1]=0,c[2]=0,c)},vec3.lerp=function(a,b,c,d){return d||(d=a),d[0]=a[0]+c*(b[0]-a[0]),d[1]=a[1]+c*(b[1]-a[1]),d[2]=a[2]+c*(b[2]-a[2]),d},vec3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var mat3={};mat3.create=function(a){var b=new glMatrixArrayType(9);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9]),b},mat3.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},mat3.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.transpose=function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[5];return a[1]=a[3],a[2]=a[6],a[3]=c,a[5]=a[7],a[6]=d,a[7]=e,a}return b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8],b},mat3.toMat4=function(a,b){return b||(b=mat4.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=0,b[4]=a[3],b[5]=a[4],b[6]=a[5],b[7]=0,b[8]=a[6],b[9]=a[7],b[10]=a[8],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},mat3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"};var mat4={};mat4.create=function(a){var b=new glMatrixArrayType(16);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]),b},mat4.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},mat4.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.transpose=function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],h=a[11];return a[1]=a[4],a[2]=a[8],a[3]=a[12],a[4]=c,a[6]=a[9],a[7]=a[13],a[8]=d,a[9]=f,a[11]=a[14],a[12]=e,a[13]=g,a[14]=h,a}return b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15],b},mat4.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14];return a=a[15],n*k*h*e-j*o*h*e-n*g*l*e+f*o*l*e+j*g*p*e-f*k*p*e-n*k*d*i+j*o*d*i+n*c*l*i-b*o*l*i-j*c*p*i+b*k*p*i+n*g*d*m-f*o*d*m-n*c*h*m+b*o*h*m+f*c*p*m-b*g*p*m-j*g*d*a+f*k*d*a+j*c*h*a-b*k*h*a-f*c*l*a+b*g*l*a},mat4.inverse=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=1/(s*D-t*C+u*B+v*A-w*z+x*y);return b[0]=(h*D-i*C+j*B)*E,b[1]=(-d*D+e*C-f*B)*E,b[2]=(p*x-q*w+r*v)*E,b[3]=(-l*x+m*w-n*v)*E,b[4]=(-g*D+i*A-j*z)*E,b[5]=(c*D-e*A+f*z)*E,b[6]=(-o*x+q*u-r*t)*E,b[7]=(k*x-m*u+n*t)*E,b[8]=(g*C-h*A+j*y)*E,b[9]=(-c*C+d*A-f*y)*E,b[10]=(o*w-p*u+r*s)*E,b[11]=(-k*w+l*u-n*s)*E,b[12]=(-g*B+h*z-i*y)*E,b[13]=(c*B-d*z+e*y)*E,b[14]=(-o*v+p*t-q*s)*E,b[15]=(k*v-l*t+m*s)*E,b},mat4.toRotationMat=function(a,b){return b||(b=mat4.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},mat4.toMat3=function(a,b){return b||(b=mat3.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[4],b[4]=a[5],b[5]=a[6],b[6]=a[8],b[7]=a[9],b[8]=a[10],b},mat4.toInverseMat3=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=a[8],j=a[9],k=a[10],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,b||(b=mat3.create()),b[0]=l*o,b[1]=(-k*d+e*j)*o,b[2]=(h*d-e*g)*o,b[3]=m*o,b[4]=(k*c-e*i)*o,b[5]=(-h*c+e*f)*o,b[6]=n*o,b[7]=(-j*c+d*i)*o,b[8]=(g*c-d*f)*o,b):null},mat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14];a=a[15];var s=b[0],t=b[1],u=b[2],v=b[3],w=b[4],x=b[5],y=b[6],z=b[7],A=b[8],B=b[9],C=b[10],D=b[11],E=b[12],F=b[13],G=b[14];return b=b[15],c[0]=s*d+t*h+u*l+v*p,c[1]=s*e+t*i+u*m+v*q,c[2]=s*f+t*j+u*n+v*r,c[3]=s*g+t*k+u*o+v*a,c[4]=w*d+x*h+y*l+z*p,c[5]=w*e+x*i+y*m+z*q,c[6]=w*f+x*j+y*n+z*r,c[7]=w*g+x*k+y*o+z*a,c[8]=A*d+B*h+C*l+D*p,c[9]=A*e+B*i+C*m+D*q,c[10]=A*f+B*j+C*n+D*r,c[11]=A*g+B*k+C*o+D*a,c[12]=E*d+F*h+G*l+b*p,c[13]=E*e+F*i+G*m+b*q,c[14]=E*f+F*j+G*n+b*r,c[15]=E*g+F*k+G*o+b*a,c},mat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1];return b=b[2],c[0]=a[0]*d+a[4]*e+a[8]*b+a[12],c[1]=a[1]*d+a[5]*e+a[9]*b+a[13],c[2]=a[2]*d+a[6]*e+a[10]*b+a[14],c},mat4.multiplyVec4=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2];return b=b[3],c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*b,c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*b,c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*b,c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*b,c},mat4.translate=function(a,b,c){var d=b[0],e=b[1];
if(b=b[2],!c||a==c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;var f=a[0],g=a[1],h=a[2],i=a[3],j=a[4],k=a[5],l=a[6],m=a[7],n=a[8],o=a[9],p=a[10],q=a[11];return c[0]=f,c[1]=g,c[2]=h,c[3]=i,c[4]=j,c[5]=k,c[6]=l,c[7]=m,c[8]=n,c[9]=o,c[10]=p,c[11]=q,c[12]=f*d+j*e+n*b+a[12],c[13]=g*d+k*e+o*b+a[13],c[14]=h*d+l*e+p*b+a[14],c[15]=i*d+m*e+q*b+a[15],c},mat4.scale=function(a,b,c){var d=b[0],e=b[1];return b=b[2],c&&a!=c?(c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d,c[4]=a[4]*e,c[5]=a[5]*e,c[6]=a[6]*e,c[7]=a[7]*e,c[8]=a[8]*b,c[9]=a[9]*b,c[10]=a[10]*b,c[11]=a[11]*b,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c):(a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a)},mat4.rotate=function(a,b,c,d){var e=c[0],f=c[1];c=c[2];var g=Math.sqrt(e*e+f*f+c*c);if(!g)return null;1!=g&&(g=1/g,e*=g,f*=g,c*=g);var h=Math.sin(b),i=Math.cos(b),j=1-i;b=a[0],g=a[1];var k=a[2],l=a[3],m=a[4],n=a[5],o=a[6],p=a[7],q=a[8],r=a[9],s=a[10],t=a[11],u=e*e*j+i,v=f*e*j+c*h,w=c*e*j-f*h,x=e*f*j-c*h,y=f*f*j+i,z=c*f*j+e*h,A=e*c*j+f*h;return e=f*c*j-e*h,f=c*c*j+i,d?a!=d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a,d[0]=b*u+m*v+q*w,d[1]=g*u+n*v+r*w,d[2]=k*u+o*v+s*w,d[3]=l*u+p*v+t*w,d[4]=b*x+m*y+q*z,d[5]=g*x+n*y+r*z,d[6]=k*x+o*y+s*z,d[7]=l*x+p*y+t*z,d[8]=b*A+m*e+q*f,d[9]=g*A+n*e+r*f,d[10]=k*A+o*e+s*f,d[11]=l*A+p*e+t*f,d},mat4.rotateX=function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[4],f=a[5],g=a[6],h=a[7],i=a[8],j=a[9],k=a[10],l=a[11];return c?a!=c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[4]=e*b+i*d,c[5]=f*b+j*d,c[6]=g*b+k*d,c[7]=h*b+l*d,c[8]=e*-d+i*b,c[9]=f*-d+j*b,c[10]=g*-d+k*b,c[11]=h*-d+l*b,c},mat4.rotateY=function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[0],f=a[1],g=a[2],h=a[3],i=a[8],j=a[9],k=a[10],l=a[11];return c?a!=c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[0]=e*b+i*-d,c[1]=f*b+j*-d,c[2]=g*b+k*-d,c[3]=h*b+l*-d,c[8]=e*d+i*b,c[9]=f*d+j*b,c[10]=g*d+k*b,c[11]=h*d+l*b,c},mat4.rotateZ=function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[0],f=a[1],g=a[2],h=a[3],i=a[4],j=a[5],k=a[6],l=a[7];return c?a!=c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[0]=e*b+i*d,c[1]=f*b+j*d,c[2]=g*b+k*d,c[3]=h*b+l*d,c[4]=e*-d+i*b,c[5]=f*-d+j*b,c[6]=g*-d+k*b,c[7]=h*-d+l*b,c},mat4.frustum=function(a,b,c,d,e,f,g){g||(g=mat4.create());var h=b-a,i=d-c,j=f-e;return g[0]=2*e/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=2*e/i,g[6]=0,g[7]=0,g[8]=(b+a)/h,g[9]=(d+c)/i,g[10]=-(f+e)/j,g[11]=-1,g[12]=0,g[13]=0,g[14]=-(f*e*2)/j,g[15]=0,g},mat4.perspective=function(a,b,c,d,e){return a=c*Math.tan(a*Math.PI/360),b*=a,mat4.frustum(-b,b,-a,a,c,d,e)},mat4.ortho=function(a,b,c,d,e,f,g){g||(g=mat4.create());var h=b-a,i=d-c,j=f-e;return g[0]=2/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=2/i,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=-2/j,g[11]=0,g[12]=-(a+b)/h,g[13]=-(d+c)/i,g[14]=-(f+e)/j,g[15]=1,g},mat4.lookAt=function(a,b,c,d){d||(d=mat4.create());var e=a[0],f=a[1];a=a[2];var g=c[0],h=c[1],i=c[2];c=b[1];var j=b[2];if(e==b[0]&&f==c&&a==j)return mat4.identity(d);var k,l,m,n;return c=e-b[0],j=f-b[1],b=a-b[2],n=1/Math.sqrt(c*c+j*j+b*b),c*=n,j*=n,b*=n,k=h*b-i*j,i=i*c-g*b,g=g*j-h*c,(n=Math.sqrt(k*k+i*i+g*g))?(n=1/n,k*=n,i*=n,g*=n):g=i=k=0,h=j*g-b*i,l=b*k-c*g,m=c*i-j*k,(n=Math.sqrt(h*h+l*l+m*m))?(n=1/n,h*=n,l*=n,m*=n):m=l=h=0,d[0]=k,d[1]=h,d[2]=c,d[3]=0,d[4]=i,d[5]=l,d[6]=j,d[7]=0,d[8]=g,d[9]=m,d[10]=b,d[11]=0,d[12]=-(k*e+i*f+g*a),d[13]=-(h*e+l*f+m*a),d[14]=-(c*e+j*f+b*a),d[15]=1,d},mat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"},quat4={},quat4.create=function(a){var b=new glMatrixArrayType(4);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]),b},quat4.set=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},quat4.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];return b&&a!=b?(b[0]=c,b[1]=d,b[2]=e,b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),b):(a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a)},quat4.inverse=function(a,b){return b&&a!=b?(b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=a[3],b):(a[0]*=1,a[1]*=1,a[2]*=1,a)},quat4.length=function(a){var b=a[0],c=a[1],d=a[2];return a=a[3],Math.sqrt(b*b+c*c+d*d+a*a)},quat4.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=Math.sqrt(c*c+d*d+e*e+f*f);return 0==g?(b[0]=0,b[1]=0,b[2]=0,b[3]=0,b):(g=1/g,b[0]=c*g,b[1]=d*g,b[2]=e*g,b[3]=f*g,b)},quat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2];a=a[3];var g=b[0],h=b[1],i=b[2];return b=b[3],c[0]=d*b+a*g+e*i-f*h,c[1]=e*b+a*h+f*g-d*i,c[2]=f*b+a*i+d*h-e*g,c[3]=a*b-d*g-e*h-f*i,c},quat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2];b=a[0];var g=a[1],h=a[2];a=a[3];var i=a*d+g*f-h*e,j=a*e+h*d-b*f,k=a*f+b*e-g*d;return d=-b*d-g*e-h*f,c[0]=i*a+d*-b+j*-h-k*-g,c[1]=j*a+d*-g+k*-b-i*-h,c[2]=k*a+d*-h+i*-g-j*-b,c},quat4.toMat3=function(a,b){b||(b=mat3.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h;c*=i;var l=d*h;return d*=i,e*=i,g*=f,h*=f,f*=i,b[0]=1-(l+e),b[1]=k-f,b[2]=c+h,b[3]=k+f,b[4]=1-(j+e),b[5]=d-g,b[6]=c-h,b[7]=d+g,b[8]=1-(j+l),b},quat4.toMat4=function(a,b){b||(b=mat4.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h;c*=i;var l=d*h;return d*=i,e*=i,g*=f,h*=f,f*=i,b[0]=1-(l+e),b[1]=k-f,b[2]=c+h,b[3]=0,b[4]=k+f,b[5]=1-(j+e),b[6]=d-g,b[7]=0,b[8]=c-h,b[9]=d+g,b[10]=1-(j+l),b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},quat4.slerp=function(a,b,c,d){d||(d=a);var e=c;return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]<0&&(e=-1*c),d[0]=1-c*a[0]+e*b[0],d[1]=1-c*a[1]+e*b[1],d[2]=1-c*a[2]+e*b[2],d[3]=1-c*a[3]+e*b[3],d},quat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var gl,LightFragmentShader="precision mediump float;varying vec3 vLightWeighting;varying vec4 vColor;void main(void){gl_FragColor = vec4(vLightWeighting, 1.0) * vColor;}",LightVertexShader="attribute vec3 aVertexPosition;attribute vec3 aVertexNormal;uniform vec4 uVertexColor;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;uniform mat3 uNMatrix;uniform vec3 uAmbientColor;uniform vec3 uLightingDirection;uniform vec3 uDirectionalColor;varying vec3 vLightWeighting;varying vec4 vColor;void main(void){gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);vec3 transformedNormal = uNMatrix * aVertexNormal;float directionalLightWeighting = max(dot(transformedNormal, uLightingDirection), 0.0);vLightWeighting = uAmbientColor + uDirectionalColor * directionalLightWeighting;vColor = uVertexColor;}",TextureFragmentShader="precision mediump float;varying vec2 vTextureCoord;uniform sampler2D uSampler;void main(void){gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));}",TextureVertexShader="attribute vec3 aVertexPosition;attribute vec2 aTextureCoord;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying vec2 vTextureCoord;void main(void){gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);vTextureCoord = aTextureCoord;}",shaderProgramLight,shaderProgramTexture,BackgroundTexture,ImagesArray=[],currentlyPressedKeys={},pitch=0,pitchRate=0,yaw=0,yawRate=0,xPos=0,yPos=.4,zPos=0,speed=0,ModelColor=[1,1,1,1],lastTime=0,joggingAngle=0,WebGL={};WebGL.InitApp=function(a){var b=document.createElement("canvas");b.setAttribute("id","webgl-canvas"),b.setAttribute("width",a.offsetWidth),b.setAttribute("height",a.offsetHeight),a.appendChild(b),MainWebGL()},WebGL.PosX=function(a){xPos=a},WebGL.PosZ=function(a){zPos=-a},WebGL.RotateX=function(a){yaw=a-90},WebGL.RotateY=function(a){pitch=a+90},WebGL.ModelColor=function(a){function b(a){return a/255}ModelColor=a,ModelColor=[b(a[0]),b(a[1]),b(a[2]),b(a[3])]},WebGL.Background=function(a){TextureImage3(a)},WebGL.SetImage=function(a,b){SetTextureImage(a,b)},WebGL.ShowImage=function(a){ShowTextureImage(a)},WebGL.CheckImages=function(){for(i=0;i<ImagesArray.length;i++)console.log(ImagesArray[i])};var Matrix={},Vector3={};Matrix.sTemp=new Float32Array(32),Matrix.multiplyMM=function(a,b,c,d,e,f){a||(a=c);var g=c[0],h=c[1],i=c[2],j=c[3],k=c[4],l=c[5],m=c[6],n=c[7],o=c[8],p=c[9],q=c[10],r=c[11],s=c[12],t=c[13],u=c[14],v=c[15],w=e[0],x=e[1],y=e[2],z=e[3],A=e[4],B=e[5],C=e[6],D=e[7],E=e[8],F=e[9],G=e[10],H=e[11],I=e[12],J=e[13],K=e[14],L=e[15];a[0]=w*g+x*k+y*o+z*s,a[1]=w*h+x*l+y*p+z*t,a[2]=w*i+x*m+y*q+z*u,a[3]=w*j+x*n+y*r+z*v,a[4]=A*g+B*k+C*o+D*s,a[5]=A*h+B*l+C*p+D*t,a[6]=A*i+B*m+C*q+D*u,a[7]=A*j+B*n+C*r+D*v,a[8]=E*g+F*k+G*o+H*s,a[9]=E*h+F*l+G*p+H*t,a[10]=E*i+F*m+G*q+H*u,a[11]=E*j+F*n+G*r+H*v,a[12]=I*g+J*k+K*o+L*s,a[13]=I*h+J*l+K*p+L*t,a[14]=I*i+J*m+K*q+L*u,a[15]=I*j+J*n+K*r+L*v},Matrix.multiplyMV=function(a,b,c,d,e,f){},Matrix.transposeM=function(a,b,c,d){if(!c||a==c){var e=a[1],f=a[2],g=a[5];return a[1]=a[3],a[2]=a[6],a[3]=e,a[5]=a[7],a[6]=f,a[7]=g,a}return c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8],c},Matrix.invertM=function(a,b,c,d){var e=c[d+0],f=c[d+1],g=c[d+2],h=c[d+3],i=c[d+4],j=c[d+5],k=c[d+6],l=c[d+7],m=c[d+8],n=c[d+9],o=c[d+10],p=c[d+11],q=c[d+12],r=c[d+13],s=c[d+14],t=c[d+15],u=o*t,v=s*p,w=k*t,x=s*l,y=k*p,z=o*l,A=g*t,B=s*h,C=g*p,D=o*h,E=g*l,F=k*h,G=u*j+x*n+y*r-(v*j+w*n+z*r),H=v*f+A*n+D*r-(u*f+B*n+C*r),I=w*f+B*j+E*r-(x*f+A*j+F*r),J=z*f+C*j+F*n-(y*f+D*j+E*n),K=v*i+w*m+z*q-(u*i+x*m+y*q),L=u*e+B*m+C*q-(v*e+A*m+D*q),M=x*e+A*i+F*q-(w*e+B*i+E*q),N=y*e+D*i+E*m-(z*e+C*i+F*m),O=m*r,P=q*n,Q=i*r,R=q*j,S=i*n,T=m*j,U=e*r,V=q*f,W=e*n,X=m*f,Y=e*j,Z=i*f,$=O*l+R*p+S*t-(P*l+Q*p+T*t),_=P*h+U*p+X*t-(O*h+V*p+W*t),aa=Q*h+V*l+Y*t-(R*h+U*l+Z*t),ba=T*h+W*l+Z*p-(S*h+X*l+Y*p),ca=Q*o+T*s+P*k-(S*s+O*k+R*o),da=W*s+O*g+V*o-(U*o+X*s+P*g),ea=U*k+Z*s+R*g-(Y*s+Q*g+V*k),fa=Y*o+S*g+X*k-(W*k+Z*o+T*g),ga=e*G+i*H+m*I+q*J;if(0==ga)return!1;var ha=1/ga;return a[b]=G*ha,a[1+b]=H*ha,a[2+b]=I*ha,a[3+b]=J*ha,a[4+b]=K*ha,a[5+b]=L*ha,a[6+b]=M*ha,a[7+b]=N*ha,a[8+b]=$*ha,a[9+b]=_*ha,a[10+b]=aa*ha,a[11+b]=ba*ha,a[12+b]=ca*ha,a[13+b]=da*ha,a[14+b]=ea*ha,a[15+b]=fa*ha,!0},Matrix.orthoM=function(a,b,c,d,e,f,g,h){if(c==d)throw new IllegalArgumentException("left == right");if(e==f)throw new IllegalArgumentException("bottom == top");if(g==h)throw new IllegalArgumentException("near == far");var i=1/(d-c),j=1/(f-e),k=1/(h-g),l=2*i,m=2*j,n=-2*k,o=-(d+c)*i,p=-(f+e)*j,q=-(h+g)*k;a[b+0]=l,a[b+5]=m,a[b+10]=n,a[b+12]=o,a[b+13]=p,a[b+14]=q,a[b+15]=1,a[b+1]=0,a[b+2]=0,a[b+3]=0,a[b+4]=0,a[b+6]=0,a[b+7]=0,a[b+8]=0,a[b+9]=0,a[b+11]=0},Matrix.frustumM=function(a,b,c,d,e,f,g,h){if(c==d)throw new IllegalArgumentException("left == right");if(f==e)throw new IllegalArgumentException("top == bottom");if(g==h)throw new IllegalArgumentException("near == far");if(g<=0)throw new IllegalArgumentException("near <= 0.0f");if(h<=0)throw new IllegalArgumentException("far <= 0.0f");var i=1/(d-c),j=1/(f-e),k=1/(g-h),l=2*(g*i),m=2*(g*j),n=(d+c)*i,o=(f+e)*j,p=(h+g)*k,q=2*(h*g*k);a[b+0]=l,a[b+5]=m,a[b+8]=n,a[b+9]=o,a[b+10]=p,a[b+14]=q,a[b+11]=-1,a[b+1]=0,a[b+2]=0,a[b+3]=0,a[b+4]=0,a[b+6]=0,a[b+7]=0,a[b+12]=0,a[b+13]=0,a[b+15]=0},Matrix.perspectiveM=function(a,b,c,d,e,f){var g=1/Math.tan(c*(Math.PI/360)),h=1/(e-f);a[b+0]=g/d,a[b+1]=0,a[b+2]=0,a[b+3]=0,a[b+4]=0,a[b+5]=g,a[b+6]=0,a[b+7]=0,a[b+8]=0,a[b+9]=0,a[b+10]=(f+e)*h,a[b+11]=-1,a[b+12]=0,a[b+13]=0,a[b+14]=2*f*e*h,a[b+15]=0},Matrix.length=function(a,b,c){return Math.sqrt(a*a+b*b+c*c)},Matrix.setIdentityM=function(a,b){for(var c=0;c<16;c++)a[b+c]=0;for(var c=0;c<16;c+=5)a[b+c]=1},Matrix.scaleM=function(a,b,c,d,e,f,g){if(7==arguments.lengh)for(var h=0;h<4;h++){var i=g+h,j=b+h;f[i]=a[j]*c,f[4+i]=a[4+j]*d,f[8+i]=a[8+j]*e,f[12+i]=a[12+j]}else for(var h=0;h<4;h++){var j=b+h;a[j]*=c,a[4+j]*=d,a[8+j]*=e}},Matrix.translateM=function(a,b,c,d,e,f,g){if(7==arguments.lengh){for(var h=0;h<12;h++)f[g+h]=a[b+h];for(var h=0;h<4;h++){var i=g+h,j=b+h;f[12+i]=a[j]*c+a[4+j]*d+a[8+j]*e+a[12+j]}}else for(var h=0;h<4;h++){var j=b+h;a[12+j]+=a[j]*c+a[4+j]*d+a[8+j]*e}},Matrix.rotateM=function(a,b,c,d,e,f,g,h){if(8!=arguments.lengh){var i=Math.sqrt(d*d+e*e+f*f);if(!i)return null;1!=i&&(i=1/i,d*=i,e*=i,f*=i);var j=Math.sin(c),k=Math.cos(c),l=1-k,m=a[0],n=a[1],o=a[2],p=a[3],q=a[4],r=a[5],s=a[6],t=a[7],u=a[8],v=a[9],w=a[10],x=a[11],y=d*d*l+k,z=e*d*l+f*j,A=f*d*l-e*j,B=d*e*l-f*j,C=e*e*l+k,D=f*e*l+d*j,E=d*f*l+e*j,F=e*f*l-d*j,G=f*f*l+k;return g?a!=g&&(g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]):g=a,g[0]=m*y+q*z+u*A,g[1]=n*y+r*z+v*A,g[2]=o*y+s*z+w*A,g[3]=p*y+t*z+x*A,g[4]=m*B+q*C+u*D,g[5]=n*B+r*C+v*D,g[6]=o*B+s*C+w*D,g[7]=p*B+t*C+x*D,g[8]=m*E+q*F+u*G,g[9]=n*E+r*F+v*G,g[10]=o*E+s*F+w*G,g[11]=p*E+t*F+x*G,g}this.setRotateM(a,0,c,d,e,f),this.multiplyMM(g,h,a,b,a,0)},Matrix.InverseToMat3=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=a[8],j=a[9],k=a[10],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;if(!o)return null;var p=1/o;return b||(b=mat3.create()),b[0]=l*p,b[1]=(-k*d+e*j)*p,b[2]=(h*d-e*g)*p,b[3]=m*p,b[4]=(k*c-e*i)*p,b[5]=(-h*c+e*f)*p,b[6]=n*p,b[7]=(-j*c+d*i)*p,b[8]=(g*c-d*f)*p,b},Matrix.ArrayCopy=function(a,b,c,d,e){2===arguments.length?(a=arguments[0],c=arguments[1],e=a.length):3===arguments.length?(a=arguments[0],c=arguments[1],e=arguments[2]):5===arguments.length&&(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],e=arguments[4]);for(var f=b,g=d;f<e+b;f++,g++){if(null===c[g])throw"array index out of bounds exception";c[g]=a[f]}},Matrix.setRotateM=function(a,b,c,d,e,f){a[b+3]=0,a[b+7]=0,a[b+11]=0,a[b+12]=0,a[b+13]=0,a[b+14]=0,a[b+15]=1,c*=Math.PI/180;var g=Math.sin(c),h=Math.cos(c);if(1==d&&0==e&&0==f)a[b+5]=h,a[b+10]=h,a[b+6]=g,a[b+9]=-g,a[b+1]=0,a[b+2]=0,a[b+4]=0,a[b+8]=0,a[b+0]=1;else if(0==d&&1==e&&0==f)a[b+0]=h,a[b+10]=h,a[b+8]=g,a[b+2]=-g,a[b+1]=0,a[b+4]=0,a[b+6]=0,a[b+9]=0,a[b+5]=1;else if(0==d&&0==e&&1==f)a[b+0]=h,a[b+5]=h,a[b+1]=g,a[b+4]=-g,a[b+2]=0,a[b+6]=0,a[b+8]=0,a[b+9]=0,a[b+10]=1;else{var i=Matrix.length(d,e,f);if(1!=i){var j=1/i;d*=j,e*=j,f*=j}var k=1-h,l=d*e,m=e*f,n=f*d,o=d*g,p=e*g,q=f*g;a[b+0]=d*d*k+h,a[b+4]=l*k-q,a[b+8]=n*k+p,a[b+1]=l*k+q,a[b+5]=e*e*k+h,a[b+9]=m*k-o,a[b+2]=n*k-p,a[b+6]=m*k+o,a[b+10]=f*f*k+h}},Matrix.setRotateEulerM=function(a,b,c,d,e){c*=Math.PI/180,d*=Math.PI/180,e*=Math.PI/180;var f=Math.cos(c),g=Math.sin(c),h=Math.cos(d),i=Math.sin(d),j=Math.cos(e),k=Math.sin(e),l=f*i,m=g*i;a[b+0]=h*j,a[b+1]=-h*k,a[b+2]=i,a[b+3]=0,a[b+4]=l*j+f*k,a[b+5]=-l*k+f*j,a[b+6]=-g*h,a[b+7]=0,a[b+8]=-m*j+g*k,a[b+9]=m*k+g*j,a[b+10]=f*h,a[b+11]=0,a[b+12]=0,a[b+13]=0,a[b+14]=0,a[b+15]=1},Matrix.setLookAtM=function(a,b,c,d,e,f,g,h,i,j,k){var l=f-c,m=g-d,n=h-e,o=1/Matrix.length(l,m,n);l*=o,m*=o,n*=o;var p=m*k-n*j,q=n*i-l*k,r=l*j-m*i,s=1/Matrix.length(p,q,r);p*=s,q*=s,r*=s;var t=q*n-r*m,u=r*l-p*n,v=p*m-q*l;a[b+0]=p,a[b+1]=t,a[b+2]=-l,a[b+3]=0,a[b+4]=q,a[b+5]=u,a[b+6]=-m,a[b+7]=0,a[b+8]=r,a[b+9]=v,a[b+10]=-n,a[b+11]=0,a[b+12]=0,a[b+13]=0,a[b+14]=0,a[b+15]=1,translateM(a,b,-c,-d,-e)},Matrix.Copy=function(a,b){return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},Matrix.Identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},Vector3.Normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);return f?1==f?(b[0]=c,b[1]=d,b[2]=e,b):(f=1/f,b[0]=c*f,b[1]=d*f,b[2]=e*f,b):(b[0]=0,b[1]=0,b[2]=0,b)},Vector3.Scale=function(a,b,c){return c&&a!=c?(c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c):(a[0]*=b,a[1]*=b,a[2]*=b,a)};var worldVertexPositionBuffer=null,worldVertexTextureCoordBuffer=null,mvMatrix=new Float32Array(16),mvMatrixStack=[],pMatrix=new Float32Array(16);WebGLUtils=function(){var a=function(a){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+a+"</div></div></td></tr></table>"},b='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',c='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>',d=function(d,f,g){function h(e){var f=d.parentNode;if(f){var g=window.WebGLRenderingContext?c:b;e&&(g+="<br/><br/>Status: "+e),f.innerHTML=a(g)}}g=g||h,d.addEventListener&&d.addEventListener("webglcontextcreationerror",function(a){g(a.statusMessage)},!1);var i=e(d,f);return i||window.WebGLRenderingContext||g(""),i},e=function(a,b){for(var c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=null,e=0;e<c.length;++e){try{d=a.getContext(c[e],b)}catch(a){}if(d)break}return d};return{create3DContext:e,setupWebGL:d}}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}();